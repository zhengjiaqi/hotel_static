<!DOCTYPE html>
<html>
<head>
    <title>这一次，哪都不去；希望你，回家团聚丨去哪儿网新春伴手礼</title>
    <meta charset="UTF-8">
    <meta content="width=device-width,minimum-scale=1.00001,maximum-scale=1.00001,shrink-to-fit=no,user-scalable=no,minimal-ui" name="viewport">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta content="telephone=no" name="format-detection" />
    <!-- UC默认竖屏 ，UC强制全屏 -->
    <meta name="full-screen" content="yes"/>
    <meta name="browsermode" content="application"/>
    <!-- QQ强制竖屏 QQ强制全屏 -->
    <meta name="x5-orientation" content="portrait"/>
    <meta name="x5-fullscreen" content="true"/>
    <meta name="x5-page-mode" content="app"/>
    <link rel="stylesheet" href="http://m.qunar.com/zhuanti/animate.css" type="text/css">
    <link rel="stylesheet" href="http://m.qunar.com/zhuanti/spring-gift-main-min.css" type="text/css">
    <script>
        (function (doc, win) {    //设置rem基准
            var docEl = doc.documentElement,
                    resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
                    recalc = function () {
                        var clientWidth = docEl.clientWidth;
                        if (!clientWidth) return;
                        docEl.style.fontSize = 20 * (clientWidth / 320) + 'px';
                    };

            if (!doc.addEventListener) return;
            win.addEventListener(resizeEvt, recalc, false);
            doc.addEventListener('DOMContentLoaded', recalc, false);
        })(document, window);
        window.addEventListener('touchmove',function(e){e.preventDefault();})
    </script>
</head>
<body>
<div class="init">
    <img class="fenxiangImg" src="http://source.qunar.com/site/images/wap/touch/images/v2/images1x/sl-share-img2.jpg">
    <img class="qt-hide" src="http://source.qunar.com/site/images/wap/touch/images/v2/images1x/sl-loading-tuo.png">
    <div class="music_button active">
        <div class="music_note1 fadeInOut infinite"><div class="music-spark1 infinite"></div></div>
        <div class="music_note2 fadeInOut infinite"><div class="music-spark2 infinite"></div></div>
        <div class="music_note3 fadeInOut infinite"><div class="music-spark3 infinite"></div></div>
    </div>
    <audio class="playmusic" src="http://m.qunar.com/zhuanti/sl-bgm.mp3" loop preload="auto" autoplay="autoplay"></audio>
    <div class="qt-swiper">
        <div class="loading">
            <div class="img_div">
                <img src="http://source.qunar.com/site/images/wap/touch/images/v2/images1x/sl-huijiabg.jpg">
            </div>
            <div class="bottom-wrap active">
                <div class="slideInLeft">2015岁末最后一份礼物</div>
                <div class="slideInRight">去哪儿送您回家过年</div>
                <div class="s_button get-gift tuo">签收您的新春伴手礼</div>
            </div>
            <div class="qt-hide verification-wrap">
                <div class="bottom-wrap slideInUp testing-wrap">
                    <div class="tel-wrap"><input class="tel" type="tel" name="mobile" value="" placeholder="输入您的手机号码" maxlength="11"></div>
                    <div class="verifyCode-wrap">
                        <div class="verifyCode-item">
                            <input class="verifyCode" type="tel" name="verifyCode" placeholder="输入验证码">
                        </div>
                        <div class="code-butten">获取验证码</div>
                    </div>
                    <div class="s_button sign-in tuo">签收</div>
                </div>
            </div>

        </div>
        <ul class="content qt-hide">

        </ul>
    </div>

    <div class="active">
        <div class="alert-wrap qt-hide">
            <div class="alert ">
                <div class="al-title">去哪儿网温馨提示：</div>
                <div class="al-txtDiv">
                    <div class="al-txt msg">请输入11位有效手机号</div>
                </div>
            </div>
        </div>
        <div class="alt-mask qt-hide"></div>

        <div class="rule qt-hide">
            <div class="rule-title">活动规则</div>
            <div class="rule-head">礼包使用</div>
            <div class="rule-text">
                大礼包包含酒店和其他旅行产品红包，可在去哪儿旅行客户端首页下方“我的”中，点击“红包”或者“我的钱包-代金券”中查看，礼包中的红包与代金券可在去哪儿旅行客户端购买产品时使用，具体使用方法请以红包或代金券详情为准。
            </div>
            <div class="rule-head">领取说明</div>
            <div class="rule-text">
                大礼包每位用户限领取一次，同一手机号、同一账号、同一设备、视为同一用户，只可领取一次噢。
            </div>
            <div class="rule-head">活动声明</div>
            <div class="rule-text">
                在参加活动过程中，如果出现作弊行为（如批量注册、恶意购买、虚假交易等），去哪儿网将自动取消您本次活动资格，并有权冻结账号、取消您后续参加去哪儿网任意活动的权利，必要时追究法律责任。
            </div>
            <div class="rule-close"></div>
        </div>

        <div class="tip-mask qt-hide">
            <div class="mask_div">
                <div class="right_top">1、点击右上角&nbsp;•••</div>
                <div class="fenxiang">2、分享给小伙伴</div>
            </div>
        </div>
    </div>
    <a class="qt-hide hidden-a"></a>




</div>
<script type="text/template" id="pagetpl">
    <li class=" page1">
        <div class="middle-position">
            <div class="loading-tuo-wrap">
                <div class="steps-tuo steps2 infinite"></div>
                <div class="loading-tuo qt-hide">
                    <img class="" src="http://source.qunar.com/site/images/wap/touch/images/v2/images1x/sl-loading-tuo.png">
                    <div class="loading-tuo-back loading_inner">
                    </div>
                </div>
            </div>

            <div class="percentage loading_num"></div>
            <div class="line-1-1 fadeInUp"><%=pageText.loading[0]%></div>
            <div class="line-1-2 fadeInUp"><%=pageText.loading[1]%></div>
            <div class="line-1-3 fadeInUp"><%=pageText.loading[2]%></div>
        </div>
        <div class="line-1-4 popUp"><%=pageText.loading[3]%></div>
        <div class="top-button infinite page1-top-button"></div>
    </li>
    <li class=" page2">
        <div class="middle-position page-middle">
            <div class="hotel-img-wrap">
                <img src="http://source.qunar.com/site/images/wap/touch/images/v2/images1x/sl-hotel.jpg">
                <div class="page2-light steps2 infinite"></div>
            </div>
            <div class="fadeInUp step1 line-2-1"><%=pageText.page2[0]%></div>
            <div class="fadeInUp step2 line-2-2"><%=pageText.page2[1]%></div>
            <div class="fadeInUp step3 line-2-3"><%=pageText.page2[2]%></div>
        </div>
        <div class="fadeIn step4 page2-2">
            <div class="middle-position page-middle">
                <div class="hotel-img-wrap page-2-2-img-wrap">
                    <img class="" src="http://source.qunar.com/site/images/wap/touch/images/v2/images1x/sl-hotel-2.jpg">
                    <div class="page2-2-hand steps3 infinite"></div>
                </div>
                <div class="fadeInUp step5 line-2-4"><%=pageText.page2[3]%></div>
            </div>
            <div class="top-button infinite breathe step6"></div>
        </div>
    </li>

    <li class=" page3">
        <div class="middle-position page-middle">
            <div class="hotel-img-wrap">
                <img src="http://source.qunar.com/site/images/wap/touch/images/v2/images1x/sl-airbg.png">
                <img class="page3-cloud slideOutRight infinite" src="http://source.qunar.com/site/images/wap/touch/images/v2/images1x/sl-air-active.jpg">
            </div>
            <div class="fadeInUp step1 line-3-1"><%=pageText.page3[0]%></div>
            <div class="fadeInUp step2 line-3-2"><%=pageText.page3[1]%></div>
            <div class="fadeInUp step3 line-3-3"><%=pageText.page3[2]%></div>
        </div>
        <div class="fadeIn step4 page3-2">
            <div class="middle-position page-middle">
                <div class="hotel-img-wrap">
                    <img src="http://source.qunar.com/site/images/wap/touch/images/v2/images1x/sl-air-2.jpg">
                    <div class="page3-hand steps2 infinite"></div>
                </div>
                <div class="fadeInUp step5 line-3-4"><%=pageText.page3[3]%></div>
            </div>
            <div class="top-button infinite breathe step6"></div>
        </div>
    </li>
    <li class=" page4">
        <div class="middle-position page-middle">
            <div class="hotel-img-wrap">
                <img src="http://source.qunar.com/site/images/wap/touch/images/v2/images1x/sl-train.jpg">
                <div class="page4-train steps2 infinite"></div>
            </div>
            <div class="fadeInUp step1 line-4-1"><%=pageText.page4[0]%></div>
            <div class="fadeInUp step2 line-4-2"><%=pageText.page4[1]%></div>
            <div class="fadeInUp step3 line-4-3"><%=pageText.page4[2]%></div>
        </div>
        <div class="fadeIn step4 page4-2">
            <div class="middle-position page-middle">
                <div class="hotel-img-wrap steps4 infinite page4-img-wrap"></div>
                <div class="fadeInUp step5 line-4-4"><%=pageText.page4[3]%></div>
            </div>
            <div class="top-button infinite breathe step6"></div>
        </div>
    </li>
    <li class=" page5">
        <div class="middle-position page-middle">
            <div class="hotel-img-wrap steps3 infinite page5-img-wrap"></div>
            <div class="fadeInUp step1 line-5-1"><%=pageText.page5[0]%></div>
            <div class="fadeInUp step2 line-5-2"><%=pageText.page5[1]%></div>
            <div class="fadeInUp step3 line-5-3"><%=pageText.page5[2]%></div>
        </div>
        <div class="fadeIn step4 page5-2">
            <div class="middle-position page-middle">
                <div class="hotel-img-wrap">
                    <img src="http://source.qunar.com/site/images/wap/touch/images/v2/images1x/sl-dujia-2.jpg">
                    <div class="page5-2-dujia steps4 infinite"></div>
                </div>
                <div class="fadeInUp step5 line-5-4"><%=pageText.page5[3]%></div>
            </div>
            <div class="top-button infinite breathe step6"></div>
        </div>
    </li>
    <li class=" page6">
        <div class="middle-position page-middle">
            <div class="hotel-img-wrap">
                <img src="http://source.qunar.com/site/images/wap/touch/images/v2/images1x/sl-menpiao.jpg">
                <div class="page6-menpiao steps2 infinite"></div>
            </div>
            <div class="fadeInUp step1 line-6-1"><%=pageText.page6[0]%></div>
            <div class="fadeInUp step2 line-6-2"><%=pageText.page6[1]%></div>
            <div class="fadeInUp step3 line-6-3"><%=pageText.page6[2]%></div>
        </div>
        <div class="fadeIn step4 page6-2">
            <div class="middle-position page-middle">
                <div class="hotel-img-wrap">
                    <img src="http://source.qunar.com/site/images/wap/touch/images/v2/images1x/sl-menpiao-2.jpg">
                    <div class="page6-2-menpiao-wrap slideOutLeftLong">
                        <div class="page6-2-menpiao steps2 infinite"></div>
                    </div>
                </div>
                <div class="fadeInUp step5 line-6-3"><%=pageText.page6[3]%></div>
            </div>
            <div class="top-button infinite breathe step6"></div>
        </div>
    </li>
    <li class=" page7">
        <div class="middle-position page-middle">
            <div class="hotel-img-wrap ">
                <img src="http://source.qunar.com/site/images/wap/touch/images/v2/images1x/sl-cheche.jpg">
                <div class="page7-2-cheche steps2 infinite"></div>
            </div>
            <div class="fadeInUp step1 line-7-1"><%=pageText.page7[0]%></div>
            <div class="fadeInUp step2 line-7-2"><%=pageText.page7[1]%></div>
            <div class="fadeInUp step3 line-7-3"><%=pageText.page7[2]%></div>
        </div>
        <div class="fadeIn step4 page7-2">
            <div class="middle-position page-middle">
                <div class="hotel-img-wrap steps2 infinite page7-img-wrap"></div>
                <div class="fadeInUp step5 line-7-3"><%=pageText.page7[3]%></div>
            </div>
            <div class="top-button infinite breathe step6"></div>
        </div>
    </li>
    <li class=" page8">
        <div class="middle-position page-middle page8-middle">
            <div class="fadeInDown hotel-img-wrap page8-img-wrap">
                <img src="http://source.qunar.com/site/images/wap/touch/images/v2/images1x/send-red.jpg">
            </div>
            <div class="animate-wrap">
                <div class="text-wrap1">
                    <div class="fadeInUp line-8-1"><%=pageText.page8[0]%></div>
                    <div class="fadeInUp line-8-2"><%=pageText.page8[1]%></div>
                    <div class="fadeInUp line-8-3"><%=pageText.page8[2]%></div>
                    <div class="fadeInUp line-8-4"><%=pageText.page8[3]%></div>
                </div>
                <div class="popUp text-wrap2">
                    <div class=" line-8-5"><%=pageText.page8[4]%></div>
                    <div class=" line-8-6"><%=pageText.page8[5]%></div>
                    <div class=" line-8-7"><%=pageText.page8[6]%></div>
                    <div class="red-wrap">
                        <%if(red && red.coupons){%>
                        <%_.each(red.coupons,function(item,index){%>
                            <div class="line-8-<%=(8+index)%>"><%=item.couponTitle%>：<%=item.couponMoney%>元</div>
                        <%})%>
                        <%}%>
                    </div>

                    <div class="rubberBand red-button">立即使用</div>
                </div>
            </div>
        </div>
        <div class="line-8-12 popUp">重新回顾</div>
        <div class="line-8-13 fadeIn">查看活动规则</div>
        <div class="line-8-14 fadeIn">数据严格保密，仅供个人回顾</div>
    </li>
</script>
<script>
    var $init=document.querySelector('.init');
    var touchStartTime;
    $init.addEventListener('touchstart',function(e){
        if(!touchStartTime || touchStartTime==0){
            touchStartTime=new Date().getTime();
            setTimeout(function(){
                touchStartTime=0;
            },310);
        }else{
            var time=new Date().getTime()-touchStartTime;
            if(time<=500){
                e.preventDefault();
            }
        }
    },false);
</script>
<!--<script type="text/javascript" src="http://qunarzz.com/mobile_touch/prd/v2/js/zepto-2014012117315602.js"></script>-->
<script type="text/javascript" src="http://qunarzz.com/mobile_touch/prd/v2/js/zepto-2015090714215161.js"></script>
<script type="text/javascript" src="http://m.qunar.com/zhuanti/qswiper0.1.0.js"></script>
<!--<script type="text/javascript" src="./qswiper.js"></script>-->
<script src="http://m.qunar.com/zhuanti/QunarAPI_1.0.16.js"></script>
<script>
    function Loading(config) {
        this.opt = {
            anchor: '',
            autoEndNum:100,
            manualEnd:'true',
            startNum:0
        };
        for (var i in config) {
            this.opt[i] = config[i];
        }
        this.init(this.opt);

    }

    Loading.prototype = {
        init    : function (opt) {
            var me = this, opt = me.opt, $anchor = $(opt.anchor),autoEndNum=opt.autoEndNum;
            var idx = opt.startNum, time = 500;
            me.$loading_inner = $($anchor.find('.loading_inner')), me.$loading_num = $($anchor.find('.loading_num'));
            action(function(){
                idx += (100 - idx) * .2;
                me.setValue(idx.toFixed(0));
                if(me.opt.manualEnd=='true' && idx.toFixed(0)==99){
                    clearTimeout(me.timtOut);
                }else if(idx.toFixed(0)==autoEndNum.toFixed(0)){
                    clearTimeout(me.timtOut);
                    me.opt.loadEndFun();
                }

            },time);

            function action(fun,time){
                me.timtOut= setTimeout(function(){
                    action(fun,time += 100);
                    fun();
                },time);
            }
        },
        setValue: function (n) {
            var me = this;
            me.$loading_inner.css({'height':n+'%'});
            me.$loading_num.html(n+'%');
        },
        setEndValue:function(n){
            var me = this;
            clearTimeout(me.timtOut);
            me.opt.loadEndFun();
            me.setValue(n);
        },
        loadEnd:function(fun){
            this.opt.loadEndFun=fun;
        }
    }
</script>
<script>

    (function(){
        var qswiper,
            loading,
            ua = navigator.userAgent,
            bdSource = getUrlParam('bd_source') || 'qunar';

        QunarAPI.ready(function () {
            QunarAPI.hideOptionMenu({});//隐藏右上角的分享按钮
            QunarAPI.hy.navRefresh(
                    // 与openWebview中的navigation字段相同，详情见附录1。
                    {
                        title: {
                            style: 'text',
                            text: '   去哪儿网春节伴手礼'
                        }
                    }
            );
        });

        $('.init').on('tap','.top-button,.line-1-4',function(){
            qswiper.slideNext();
        })

//        $(window).on('resize',function(){
//            if(window.orientation==180||window.orientation==0){
//                alert("这样不好，竖过来吧")
//            }
//        })
        // music
        $('.init').on('tap','.music_button',function(){
            var $playmusic=$('.playmusic');
            if($(this).hasClass('music_button_off')){
                $playmusic[0].play();
            }else{
                $playmusic[0].pause();
            }
            $(this).toggleClass("active");
            $(this).toggleClass("music_button_off");
        }).one('tap',function(){
            if(!$('.music_button').hasClass('music_button_off')) {
                $('.playmusic')[0].play();
            }
        })

//      loading事件
        $('.init').on('tap','.get-gift',function(){
            var data;
            try{
                data=JSON.parse(localStorage.getItem("gift_data"));
            }catch(e){}

            if(data){
                signInSuccess(data);
            }else{
                $('.verification-wrap').addClass('active').removeClass('qt-hide');
            }

        })

        function loadingFun(){
            $('.loading-tuo').removeClass('qt-hide');
            $('.steps-tuo').addClass('qt-hide');
            loading=new Loading({anchor: '.page1',startNum: 10});
            loading.loadEnd(function(){
                setTimeout(function(){
                    loadingEnd();
                },200);
            });
        }

        function loadingEnd(){
            $('.page1-top-button').addClass('breathe');
            qswiper.startTouch();
            $('.loading-tuo').addClass('qt-hide');
            $('.steps-tuo').removeClass('qt-hide');
        }

        var timer;
        $('.init').on('tap','.code-butten', function (e) {
            var tel=$('.tel').val(),_codeButten=$('.code-butten');
            if(_codeButten.hasClass('disable')){return;}
            if(!/^1\d{10}$/.test(tel)){
                showAlert('请填写11位有效的手机号码');
                return;
            };
            $.ajax({
                url     : 'http://touch.qunar.com/h5/hotel/hotelorderinfosimple?action=code&mobile=' + tel,
                dataType: 'json',
                success : function (data) {
                    console.log(data);
                    if (data.ret === "true") {
                        var num = 59;
                        if (timer) clearInterval(timer);
                        _codeButten.addClass('disable');
                        timer = setInterval(function () {
                            if (num > 0) {
                                _codeButten.html(num + 's后重获');
                                num--;
                            } else {
                                clearInterval(timer);
                                _codeButten.html('重新获取').removeClass('disable');
                            }
                        }, 1000);

                    } else {
                        showAlert(data.errmsg);
                        clearInterval(timer);
                        _codeButten.html('重新获取').removeClass('disable');
                    }
                },
                error   : function () {
                    showAlert('未知错误，请稍后再试');
                    clearInterval(timer);
                    _codeButten.html('重新获取').removeClass('disable');
                }
            });
        });

        $('.init').on('tap','.sign-in',function(){
            $('.hidden-a').focus();
            var mobile=$('.tel').val(),me=this;
            var vcode=$('.verifyCode').val();
            if($(me).hasClass('disable')){
                return;
            }
            if(!/^1\d{10}$/.test(mobile)){
                showAlert('请填写11位有效的手机号码');
                return;
            };
            if(!vcode){
                showAlert('请填写验证码');
                return;
            };
            $('input').each(function () {
                this.blur && this.blur()
            });
            $(me).addClass('disable');
            $.ajax({
                url     : 'http://touch.qunar.com/h5/red/springhomered',
                data    : {
                    mobile:mobile,
                    vcode:vcode,
                    bd_source:'banshouli',
                    c: getCookieValue('_challenge'),
                    a: getCookieValue('QN254')
                },
                dataType: 'json',
                success : function (data) {
                    console.log(data);
                    if(data.err){
                        $.Captcha.refreshCaptcha();
                        showAlert(data.err);
                        $(me).removeClass('disable');
                    }else{
                        $('input').each(function () {
                            this.blur && this.blur()
                        });
                        setTimeout(function(){
                            signInSuccess(data);
                            $(me).removeClass('disable');
                        },500);
                    }

                },
                error   : function (err) {
                    $.Captcha.refreshCaptcha();
                    $(me).removeClass('disable');
                    console.log(err);
                }
            })
        })

        function signInSuccess (req){
            if(req.red){
                try{
                    localStorage.setItem("gift_data", JSON.stringify(req));
                }catch(e){}
            }
            $('input').each(function () {
                this.blur && this.blur()
            });
            req = reqPretreatment(req);
            bulidTemple(req);

            loadingFun();
            getImgLoadStatus(function(){loading.setEndValue(100);});

            buildQswiper();
            if(ua.toLowerCase().indexOf('qunaraphone')!==-1 ){
                $('.step4').css({'opacity':1,'background':'#f8f1e1','z-index':'-1'});
                $('.line-1-4,.text-wrap2,.line-8-12').removeClass('popUp').addClass('fadeIn');
            }else if(ua.toLowerCase().indexOf('xiaomi')!==-1){
                $('.line-1-4,.text-wrap2,.line-8-12').removeClass('popUp').addClass('fadeIn');
            }
            if(ua.toLowerCase().indexOf('qunar')!==-1 ){
                $('.red-button').html('分享伴手礼给小伙伴');
            }else if(ua.toLowerCase().indexOf('weibo')!==-1){
                $('.red-button').html('分享伴手礼给小伙伴');
            }else{
                $('.red-button').html('立即使用');
            }
            $('.content').removeClass('qt-hide');

            $('.loading').one('webkitAnimationEnd',function(){
                $(this).addClass('qt-hide');
                $('.page1').addClass('active');

            })
            $('.loading').addClass('loading-fadeOut');

        }

//       page8事件
        $('.init').on('tap','.line-8-12,.replay-button',function(){
            qswiper.setTransitionTime(0.0001);
            qswiper.slideTo(0);
            setTimeout(function(){
                qswiper.setTransitionTime(0.5);
            },1)
        })
        $('.init').on('tap','.line-8-13,.replay-button',function(){
            showRule();
        })


        $('.init').on('tap','.red-button',function(){
            var $me = $(this),
                title = '这一次，哪都不去；希望你，回家团聚丨去哪儿网新春伴手礼',
                desc = '你和去哪儿的2015',
                imgUrl = 'http://source.qunar.com/site/images/wap/touch/images/v2/images1x/sl-share-img2.jpg';
            if(ua.toLowerCase().indexOf('qunar')!==-1 ){
                QunarAPI.ready(function () {
//                     调用QunarAPI提供的各种接口
                    QunarAPI.checkJsApi({
                        jsApiList: ['showShareItems', 'onMenuShare'], // 需要检测的JS接口列表
                        success: function (res) {
                            if (res.showShareItems && res.onMenuShare) {
                                QunarAPI.onMenuShare({
                                    title: title, // 标题
                                    link: window.location.href, // 链接URL
                                    desc: desc, // 描述
                                    imgUrl: imgUrl, // 分享图标
                                    success: function () {
                                    },// 用户确认分享后执行的回调函数
                                    cancel: function () {
                                    } // 用户取消分享后执行的回调函数
                                });
                                QunarAPI.onMenuShareTimeline({
                                    title: title, // 标题
                                    link: window.location.origin+window.location.pathname+'?bd_source='+bdSource+'_weixin', // 链接URL
                                    desc: desc, // 描述
                                    imgUrl: imgUrl, // 分享图标
                                    success: function () {
                                    },// 用户确认分享后执行的回调函数
                                    cancel: function () {
                                    } // 用户取消分享后执行的回调函数
                                });
                                QunarAPI.onMenuShareAppMessage({
                                    title: title, // 标题
                                    link: window.location.origin+window.location.pathname+'?bd_source='+bdSource+'_weixin', // 链接URL
                                    desc: desc, // 描述
                                    imgUrl: imgUrl, // 分享图标
                                    success: function () {
                                    },// 用户确认分享后执行的回调函数
                                    cancel: function () {
                                    } // 用户取消分享后执行的回调函数
                                });
                                QunarAPI.onMenuShareWeiboApp({
                                    title: title, // 标题
                                    link: window.location.origin+window.location.pathname+'?bd_source='+bdSource+'_weibo', // 链接URL
                                    desc: desc, // 描述
                                    imgUrl: imgUrl, // 分享图标
                                    success: function () {
                                    },// 用户确认分享后执行的回调函数
                                    cancel: function () {
                                    } // 用户取消分享后执行的回调函数
                                });
                                QunarAPI.hy.showShareItems({
                                    success: function () {
                                    },
                                    fail: function () {
                                    }
                                });
                            } else {
                                showAlert('请您升级至最新版客户端，升级享受去哪儿更好服务 ~');
                            }
                        }
                    });
                })
            }else if(ua.toLowerCase().indexOf('micromessenger')!==-1 ){
                var url ='http://a.app.qq.com/o/simple.jsp?pkgname=com.Qunar';
                location.href = url;
            }else if(ua.toLowerCase().indexOf('weibo')!==-1 ){
                showTipMask();
            }else{
                location.href = 'http://touch.qunar.com/h5/client?bd_source='+bdSource+'&sScheme=0&scheme=home&touchUrl=download?bd_source='+bdSource;
            }
        })
        function getUrlParam(name){
            var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
            var r = decodeURIComponent(window.location.search.substr(1)).match(reg);  //匹配目标参数
            if (r!=null) return unescape(r[2]); return ''; //返回参数值
        }

        function reqPretreatment(req){
            req.red = req.red || {};
            var data =req.data,
                    red = req.red,
                    money = 0;
            if(red && red.coupons && red.coupons.length>0){
                $.each( red.coupons, function(i, n){
                    money = money + n.couponMoney;
                });
            }
            req.money = money;
            var pageText = {
                'loading':[
                    req.userStatus && req.userStatus ? '还记得我们的初次相遇吗？' : '最美，是初次的相遇',
                    data && data.user && data.user.rank_num && data.user.rank_num!=0 ? '你是去哪儿网的第'+data.user.rank_num+'位用户' : '2015年，没有陪伴你，是我们的遗憾',
                    data && data.user && data.user.register_date && data.user.register_date!=0 ? '今天是我们相识的'+data.user.register_date+'天' : '2016年，我们愿与你，一起走在路上',
                    '回顾我们在这一年的故事',
                ],
                'page2':[
                    '这一年',
                    data && data.hotel && data.hotel.hotel_num && data.hotel.hotel_num!=0 ? '你去过'+data.hotel.hotel_num+'座城市' : '你去过许多城市',
                    data && data.hotel && data.hotel.hotel_jianye && data.hotel.hotel_jianye!=0 ? '在异乡度过'+data.hotel.hotel_jianye+'个夜晚' : '在异乡度过无数个夜晚',
                    '最安心的，是家里的那张床',
                ],
                'page3':[
                    '这一年',
                    data && data.flight && data.flight.flight_num && data.flight.flight_num!=0 ? '你飞过'+data.flight.flight_num+'个城市' : '你忙碌穿梭于多个城市之间',
                    data && data.flight && data.flight.flight_distance && data.flight.flight_distance!=0 ? '长达'+data.flight.flight_distance+'公里' : '长达数千公里',
                    '回家的航班，永远嫌慢',
                ],
                'page4':[
                    '这一年',
                    data && data.train && data.train.train_num && data.train.train_num!=0 ? '你乘火车经过'+data.train.train_num+'个城市' : '也许',
                    data && data.train && data.train.train_distance && data.train.train_distance!=0 ? '长达'+data.train.train_distance+'公里' : '你都忘记到达了多少座车站',
                    '走多远，也会记得始发站',
                ],
                'page5':[
                    '这一年',
                    data && data.dujia && data.dujia.dujia_num && data.dujia.dujia_num!=0 ? '你享受了'+data.dujia.dujia_num+'天假期' : '你享受了不少假期',
                    '最怀念的却是父母带你出游的日子',
                    '快乐像假期，越长大越珍惜',
                ],
                'page6':[
                    '这一年',
                    data && data.menpiao && data.menpiao.menpiao_num && data.menpiao.menpiao_num!=0 ? '你曾在'+data.menpiao.menpiao_num+'处景点驻足' : '你曾在世界各地的景点驻足',
                    '走过了小时候课本中的万水千山',
                    '忍不住，和家乡作比较',
                ],
                'page7':[
                    '这一年',
                    data && data.car && data.car.car_distance && data.car.car_distance!=0 ? '你乘专车经过'+data.car.car_distance+'公里' : '你乘专车穿过大街小巷',
                    '看遍了城市霓虹闪烁',
                    '最怀念的，是父母的自行车后座',
                ],
                'page8':[
                    '这一年',
                    '你在外奔波忙碌',
                    '这一次',
                    '只想让你安心回家',
                    req.money && req.money>0 ? req.money+'元' : '',
                    red && red.coupons && red.coupons.length>0 ? '伴手礼已放入你的去哪儿网账户' : '亲，伴手礼已经领完了，下回早点哦',
                    req.mobile

                ],
            }
            req.pageText=pageText;
            return req;
        }

        function buildQswiper(){
            var config={
                anchor:'.init',
                vertical:true,
                loop:false,
                limit:0.0001,
                transitionTime:.5
            };
            qswiper=new QSwiper('.init',config);

            qswiper.onSlideChange(function(pos){
                $('.percentage').html('');
            });
            qswiper.stopTouch();
        }



        function showAlert(msg,title){
            var _alert=$('.alert'),_alt_mask=$('.alt-mask'),
                _alertWrap=$('.alert-wrap');
            _alertWrap.removeClass('qt-hide').css({'width':$(window).width(),height:$(window).height()});
            _alertWrap.addClass('popUp');
            _alt_mask.removeClass('qt-hide').addClass('fadeIn');
            $('.al-title').html(title || '去哪儿网温馨提示：');
            $('.msg').html(msg);
            $('.init').one('tap',function(e){
                e.stopPropagation();
                e.preventDefault();
                _alertWrap.one($.fx.animationEnd,function(){
                    _alertWrap.addClass('qt-hide').removeClass('zoomOut');
                })
                _alt_mask.one($.fx.animationEnd,function(){
                    _alt_mask.addClass('qt-hide').removeClass('fadeOut');
                })
                _alertWrap.addClass('zoomOut').removeClass('popUp');
                _alt_mask.addClass('fadeOut').removeClass('fadeIn');
                $('.init').unbind('touchmove');
            }).on('touchmove',function(e){
                    e.preventDefault();
            });
        }

        function showRule(){
            var _alt_mask=$('.alt-mask'),
                _rule=$('.rule');
            _rule.removeClass('qt-hide').css({'width':$(window).width(),height:$(window).height()});
            _rule.addClass('zoomIn');
            _alt_mask.removeClass('qt-hide').addClass('fadeIn');
            $('.init').one('tap',function(e){
                e.stopPropagation();
                e.preventDefault();
                _rule.one($.fx.animationEnd,function(){
                    _rule.addClass('qt-hide').removeClass('zoomOut');
                })
                _alt_mask.one($.fx.animationEnd,function(){
                    _alt_mask.addClass('qt-hide').removeClass('fadeOut');
                })
                _rule.addClass('zoomOut').removeClass('zoomIn');
                _alt_mask.addClass('fadeOut').removeClass('fadeIn');
                $('.init').unbind('touchmove');
            }).on('touchmove',function(e){
                e.preventDefault();
            });
        }

        function showTipMask(){
            var _alt_mask=$('.tip-mask');
            _alt_mask.removeClass('qt-hide');
            $('.init').one('tap',function(e){
                e.stopPropagation();
                e.preventDefault();
                _alt_mask.addClass('qt-hide');
                $('.z_page').unbind('touchmove');
            }).on('touchmove',function(e){
                e.preventDefault();
            });
        }

        function bulidTemple(data){
            var element = $('.content');
            var tpl = $('#pagetpl').html();
            var render = _.template(tpl);
            var html = render(data);
            element.html(html);
        }

        function getImgLoadStatus(loaded){
            var imgs = $('.content img'),
                imgLength = imgs.length,
                readyNum = 0
            $.each( imgs, function(i, n){
                var img = new Image(); //创建一个Image对象，实现图片的预下载
                img.src = $(n).attr('src');
                img.onload = function () {
                    readyNum++;
                    if(readyNum == imgLength){
                        loaded();
                    }
                };
            });
        }

        function getCookieValue(cookieName)
        {
            var cookieValue = document.cookie;
            var cookieStartAt = cookieValue.indexOf(""+cookieName+"=");
            if(cookieStartAt==-1)
            {
                cookieStartAt = cookieValue.indexOf(cookieName+"=");
            }
            if(cookieStartAt==-1)
            {
                cookieValue = null;
            }
            else
            {
                cookieStartAt = cookieValue.indexOf("=",cookieStartAt)+1;
                cookieEndAt = cookieValue.indexOf(";",cookieStartAt);
                if(cookieEndAt==-1)
                {
                    cookieEndAt = cookieValue.length;
                }
                cookieValue = unescape(cookieValue.substring(cookieStartAt,cookieEndAt));//解码latin-1
            }
            return cookieValue;
        }


    })();
    $(function(){
        var _Captcha = {
            initCaptcha:function(duration){
                var interval = duration || 1000*60*3 ;
                $.getJSON('https://secapi.qunar.com/api/noCaptcha/get.json?callback=?', function(captcha){
                    $.qcookie.set('QN254',captcha,{path:'/',expires:new Date(Date.now() + interval)});
                });
                window.Timer = setTimeout(this.initCaptcha,interval);
            },
            refreshCaptcha:function(){
                clearTimeout(window.Timer);
                this.initCaptcha();
            }
        }
        _Captcha.initCaptcha();
        $.Captcha = _Captcha;
    });
</script>
</body>
</html>
